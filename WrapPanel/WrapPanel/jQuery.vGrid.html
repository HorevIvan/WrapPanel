<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title></title>
        <script src="/scripts/jquery-2.1.1.js"></script>
        <script src="/scripts/jquery.vgrid.js"></script>
        <script>
            var contentWidth = 200;

            function wrap() {
                $("#container").vgrid({
                    //onStart: align,
                });
            };

            function align() {
                var container = getContainer();
                var width = $(container).parent().width();
                width = width - (width % contentWidth);
                container.css('max-width', width + 'px');  
            }

            function setStyle(cssText) {
                var sheet = document.createElement('style');
                sheet.type = 'text/css';
                window.customSheet = sheet;
                (document.head || document.getElementsByTagName('head')[0]).appendChild(sheet);
                return (setStyle = function (cssText, node) {
                    if (!node || node.parentNode !== sheet)
                        return sheet.appendChild(document.createTextNode(cssText));
                    node.nodeValue = cssText;
                    return node;
                })(cssText);
            };


            function getContainer() {
                return $('#container');
            }

            function fillContent(onComplete) {
                $.ajax({
                    type: "POST",
                    url: "/ContentService.asmx/GetContent",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data, status, req, xml, xmlHttpRequest, responseXML) {
                        var contentItems = data.d;
                        var container = getContainer();
                        container.empty();
                        $.each(contentItems, function (index, contentItem) {
                            container.append("<div class='contentBlock'>" + contentItem.Html + "</div>");
                        });
                        onComplete();
                    },
                    error: function (data, status, req, xml, xmlHttpRequest, responseXML) {
                    }
                });
            }
        </script>
        <style>
            #container {
                margin-right: auto; 
                margin-left: auto;
                text-align: center;   
            }
            .contentBlock {
                background-color: silver;              
                /*width: 200px;*//*set in js*/
            }
        </style>
        <script>
            $(document).ready(function () {
                align();
                $(window).resize(align);
                setStyle('.contentBlock { width: ' + contentWidth + 'px; }');
                fillContent(wrap);
            });
        </script>
    </head>
    <body>
        http://blog.xlune.com/2009/09/vgrid/        
        <div id="container">
        </div>
    </body>
</html>
